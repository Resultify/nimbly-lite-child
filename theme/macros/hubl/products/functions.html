<!--
  label: macros -> hubl -> products -> functional.html
  templateType: "none"
  isAvailableForNewContent: false
-->
{% import '@marketplace/Resultify/Nimbly_Lite/modules/macros/image.html' as image_macros %}

{# Currency #}
{%- macro get_currency() -%}
  {%- set currency = site_settings.currency %}
  {%- set languageTag = content.language.languageTag %}
  {%- if currency -%}
    {%- set currency = currency -%}
  {%- endif -%}
  {%- if languageTag == "en-us" -%}
    {%- set currency = "USD" -%}
  {%- elif languageTag == "en" -%}
    {%- set currency = "GBP" -%}
  {%- elif languageTag == "sv" -%}
    {%- set currency = "SEK" -%}
  {%- elif languageTag == "dk" -%}
    {%- set currency = "DKK" -%}
  {%- elif languageTag == "no" -%}
    {%- set currency = "NOK" -%}
  {%- elif languageTag in ["de", "fr", "es", "it", "nl", "pt", "fi", "el", "et", "lv", "lt", "mt", "sk", "sl", "ie", "cy", "lu", "be", "at", "gr"] -%}
    {%- set currency = "EUR" -%}
  {%- else -%}
    {%- set currency = "USD" -%} {# Default fallback currency #}
  {%- endif -%}
  {{ currency }}
{%- endmacro -%}

{# Get locale for the website #}
{%- macro get_locale() -%}
  {%- set languageTag = content.language.languageTag %}
  {%- if languageTag == "en-us" -%}
    {%- set locale = "en-US" -%}
  {%- elif languageTag == "en" -%}
    {%- set locale = "en-GB" -%}
  {%- elif languageTag == "sv" -%}
    {%- set locale = "sv-SE" -%}
  {%- elif languageTag == "dk" -%}
    {%- set locale = "da-DK" -%}
  {%- elif languageTag == "no" -%}
    {%- set locale = "nb-NO" -%}
  {%- elif languageTag in ["de", "fr", "es", "it", "nl", "pt", "fi", "el", "et", "lv", "lt", "mt", "sk", "sl", "ie", "cy", "lu", "be", "at", "gr"] -%}
    {%- set locale = "eu-EU" -%}
  {%- else -%}
    {%- set locale = "en-US" -%} {# Default fallback locale #}
  {%- endif -%}
  {{ locale }}
{%- endmacro -%}

{# Product Structured Data #}
{%- macro render_structured_data(product) -%}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": "{{ product.name }}",
      "image": "{{ product.hs_images }}",
      "description": "{{ product.description }}",
      "sku": "{{ product.hs_object_id }}",
      "offers": {
        "@type": "Offer",
        "priceCurrency": "{{ product_functions_macro.get_currency() }}",
        "price": "{{ product.price }}",
        "availability": "https://schema.org/InStock"
      }
    }
  </script>
{%- endmacro -%}

{# Featured image #}
{%- macro render_product_list_image(product) -%}
  <div class="product-listing-module__product-image product-listing-module__product-item">
    {%- set image_link_aria = 'aria-label="Full product information: {{ product.description }}"' -%}
    {%- set image_data = {
      "image": {
        "size_type": "auto", "src": product.hs_images, "alt": product.name,
        "loading": "lazy", "width": "1024", "height":"1024", "max_width": null, "max_height": null
      },
      "link": { "link": { "url": { "href": product.hs_images, "type": "EXTERNAL" }, "open_in_new_tab": false, "rel": "" } },
      "caption": { "rich_text": "" }
      }%}
    {{
      image_macros.render_image_tmpl(
        image_data,
        module.style.image,
        module,
        {
          link_data_attrs: image_link_aria
        }
      )
    }}
  </div>
{%- endmacro -%}
