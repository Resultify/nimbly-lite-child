{% import '../../macros/buttons.html' as buttons %}

{% macro horizontal_alignment_flexbox(data) %}
  {% if data == 'LEFT' %}
    start
  {% elif data == 'CENTER' %}
    center
  {% elif data == 'RIGHT' %}
    end
  {% endif %}
{% endmacro %}

{# module scope css #}
<style>
  {% scope_css %}
    .card2-module {
      --aspect-ratio: {{module.aspect_ratio}};
      --richtext-alignment: {{module.style.general.alignment.horizontal_align|lower}};
      --card-alignment: {{horizontal_alignment_flexbox(module.style.general.alignment.horizontal_align)}};
      --text-color: {{module.style.general.text_color.css}};
      --stretched-link-overlay-color: {{module.style.general.overlay_color.css}};
      --card-gap: {{module.style.general.card_gap}}px;
    }
    .card2-module-text > span {
      {% if module.style.text.font.color %}
        color: {{module.style.text.font.color}};
      {% endif %}
      {% if module.style.text.background.color %}
        background-color: {{module.style.text.background.color}};
      {% endif %}
      {% if module.style.text.font.size %}
        font-size: {{module.style.text.font.size ~ 'px'}};
      {% endif %}
      {% if module.style.text.font.style %}
        {{module.style.text.font.style}};
      {% endif %}
      {{module.style.text.spacing.css}}
    }
  {% end_scope_css %}
</style>

{# stretched_link #}
{% if module.whole_area_link and module.enable_heading_link and module.heading_link.url.href %}
  {% set heading_stretched_link = true %}
{% elif module.whole_area_link %}
  {% set btn_stretched_link = true %}
{% endif %}

{%- macro render_image() -%}
  {% if module.image_type == 'full_width' %}
    {% if module.full_width_image.src %}
      <img class="card2-image full-width-image"
        alt="{{module.full_width_image.alt}}"
        src="{{module.full_width_image.src}}"
        width="{{module.full_width_image.width}}"
        height="{{module.full_width_image.height}}"
        loading="lazy">
    {% endif %}
  {% elif module.image_type == 'image' %}
    {% if module.image.src %}
      <img class="card2-image image"
        alt="{{module.image.alt}}"
        src="{{module.image.src}}"
        width="{{module.image.width}}"
        height="{{module.image.height}}"
        loading="lazy">
    {% endif %}
  {% elif module.image_type == 'icon' %}
    {% if module.icon.name %}
      {% icon
        extra_classes="card2-image icon-wrp icon--{{module.icon_style}} icon--{{module.icon_size}}"
        name="{{module.icon.name}}"
        style="{{module.icon.type}}"
        unicode="{{module.icon.unicode}}"
        icon_set="{{module.icon.icon_set}}"
        purpose="decorative"
      %}

    {% endif %}
  {% endif %}
{%- endmacro -%}


{%- macro render_heading() -%}
  {% if module.heading %}
    <{{module.heading_tag}} class="{{module.heading_style}} card2-module-heading">
      {%- if module.heading_link.url.href and module.enable_heading_link -%}
        <a href="{{module.heading_link.url.href}}" class="heading-link {{"stretched-link" if heading_stretched_link}}"
        {% if module.heading_link.open_in_new_tab %} target="_blank" {% endif %}
        {{module.heading_link.rel}}>
          {{module.heading}}
        </a>
      {%- else -%}
        {{module.heading}}
      {%- endif -%}
    </{{module.heading_tag}}>
  {% endif %}
{%- endmacro -%}

{%- macro render_subheading() -%}
  {% if module.subheading %}
    <{{module.subheading_tag}} class="{{module.subheading_style}} card2-module-subheading">
      {{module.subheading}}
    </{{module.subheading_tag}}>
  {% endif %}
{%- endmacro -%}

{%- macro render_text() -%}
  {% if module.text %}
      <div class="card2-module-text">
        <span>{{module.text}}</span>
      </div>
  {% endif %}
{%- endmacro -%}

{%- macro render_richtext() -%}
  {% if module.richtext %}
    <div class="card2-module-richtext">
      {{module.richtext|sanitize_html}}
    </div>
  {% endif %}
{%- endmacro -%}

<div class="card2-module {{module_id}}">
  <div class="block-start">
    {% for item in module.components %}
      {% if item.component|lower == 'image' %}
        {{render_image()}}
      {% elif item.component|lower == 'heading' %}
        {{render_heading()}}
      {% elif item.component|lower == 'subheading' %}
        {{render_subheading()}}
      {% elif item.component|lower == 'text' %}
        {{render_text()}}
      {% elif item.component|cut(" ")|lower == 'richtext' %}
        {{render_richtext()}}
      {% elif item.component|lower == 'separator' %}
        </div>
        <div class="block-end">
      {% elif item.component|lower == 'buttons' %}
        {{buttons.render(module.buttons, module.style, module)}}
      {% elif item.component|cut(" ")|lower == 'additionalimages' %}
      {% endif %}
    {% endfor %}
  </div>

</div>

{# add base styles to module previewer #}
{% if is_in_module_previewer %}
  {{require_css(get_asset_url("../../css/base.css"))}}
  {{require_css(get_asset_url("../../css/global-theme-settings.css"))}}
{% endif %}
